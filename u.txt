#!/bin/bash

set -euo pipefail

RESTORE_DIR="/home/user/restore"
mkdir -p "$RESTORE_DIR"

latest_backup=$(find /home/user -maxdepth 1 -type d -name 'Backup-*' 2>/dev/null | sort -r | head -n 1)

if [ -z "$latest_backup" ]; then
    echo "No backup found." >&2
    exit 1
fi

for file in "$latest_backup"/*; do
    name=$(basename "$file")
    # исключаем файлы с версионным расширением (например, file.txt.2025-04-18)
    if [[ "$name" =~ \.[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then
        continue
    fi
    if ! cp -- "$file" "$RESTORE_DIR/$name"; then
        echo "Warning: Failed to restore file '$name'" >&2
    fi

done

echo "Restored files from $(basename "$latest_backup") to $RESTORE_DIR"
